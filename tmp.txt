The Flutter DevTools debugger and profiler on Linux is available at: http://127.0.0.1:9101?uri=http://127.0.0.1:37481/ZfmtkjsUHBY=/
[38;5;12m12:07:45.359 (+0:00:01.362931)[0m
[38;5;12mğŸ” DEBUG: initializeAuth() starting - current state authenticated: false, isInitialized: false[0m
[38;5;12m12:07:45.359 (+0:00:01.363140)[0m
[38;5;12mğŸ” DEBUG: Setting state.isLoading = true[0m
[38;5;12m12:07:45.359 (+0:00:01.363271)[0m
[38;5;12mğŸš¨ [Router Listener] â•â•â• AUTH STATE CHANGE DETECTED â•â•â•[0m
[38;5;12m   - Listener callback TRIGGERED at 2025-11-11T12:07:45.356150[0m
[38;5;12m   - Previous state: auth=false, init=false, user=null, hash=726067537[0m
[38;5;12m   - Next state: auth=false, init=false, user=null, hash=812683058[0m
[38;5;12m   - States identical: false[0m
[38;5;12m   - States equal: false[0m
[38;5;12m12:07:45.360 (+0:00:01.363624)[0m
[38;5;12mğŸ”— DEBUG: Creating MagicLinkProvider - about to read magicLinkServiceDIProvider[0m
[38;5;12m12:07:45.360 (+0:00:01.363795)[0m
[38;5;12mğŸ”— DEBUG: Creating MagicLinkServiceDI - about to read magicLinkServiceProvider[0m
[38;5;12m12:07:45.360 (+0:00:01.363942)[0m
[38;5;12mğŸ”— DEBUG: MagicLinkServiceProvider resolved - type: MagicLinkRepositoryImpl[0m
[38;5;12m12:07:45.360 (+0:00:01.364067)[0m
[38;5;12mğŸ”— DEBUG: MagicLinkService created - type: MagicLinkRepositoryImpl[0m
12:07:45.360 (+0:00:01.364215)
ğŸš¨ [Router Listener] â•â•â• CRITICAL DEBUG â•â•â•
   - Check at: 2025-11-11T12:07:45.358108
   - Magic link status: MagicLinkVerificationStatus.initial
   - Error message: null
   - Can retry: false
   - State hashCode: 195644548
   - Auth changed: false
   - Hash changed: true
   - About to decide: block or allow router refresh?
12:07:45.361 (+0:00:01.364633)
ğŸš¨ [Router Listener] âœ… Magic link NOT in error state - proceeding with router refresh
   - Continuing at: 2025-11-11T12:07:45.358483
   - Router refresh will proceed normally
[38;5;208m12:07:45.361 (+0:00:01.365065)[0m
[38;5;208mğŸ”„ [Router Listener] âŒ NO meaningful changes detected - skipping router refresh[0m
[38;5;12m12:07:45.361 (+0:00:01.365215)[0m
[38;5;12mğŸ” DEBUG: State after isLoading=true - isLoading: true, isInitialized: false[0m
[38;5;12m12:07:45.362 (+0:00:01.365339)[0m
[38;5;12mğŸ” DEBUG: About to call _storageService.getToken()[0m
[38;5;12m12:07:45.363 (+0:00:01.366769)[0m
[38;5;12m[AdaptiveStorageService] Attempting to read token...[0m
[38;5;12m12:07:45.363 (+0:00:01.366912)[0m
[38;5;12m[AdaptiveStorageService] Storage key: "jwt_token_dev"[0m
[38;5;12m12:07:45.363 (+0:00:01.367029)[0m
[38;5;12m[AdaptiveStorageService] Storage backend: AdaptiveSecureStorage[0m
12:07:45.364 (+0:00:01.367537)
[AdaptiveSecureStorage] Development mode - using key as-is: "jwt_token_dev"
[38;5;12m12:07:45.364 (+0:00:01.367789)[0m
[38;5;12m[AdaptiveSecureStorage] Reading from SharedPreferences with key: "jwt_token_dev" -> found (347 chars)[0m
12:07:45.364 (+0:00:01.367985)
[AdaptiveStorageService] Development mode - read token: [347 chars]
12:07:45.364 (+0:00:01.368119)
[AdaptiveStorageService] Retrieved dev token: eyJhbGciOiJIUzI1NiIs... (347 chars)
[38;5;12m12:07:45.364 (+0:00:01.368229)[0m
[38;5;12mğŸ” DEBUG: _storageService.getToken() returned - token: EXISTS (347 chars)[0m
[38;5;12m12:07:45.365 (+0:00:01.368355)[0m
[38;5;12mğŸ” DEBUG: Token found, validating user with getCurrentUser()[0m
12:07:45.440 (+0:00:01.444159)
âœ… Using cached user data
[38;5;12m12:07:45.441 (+0:00:01.444341)[0m
[38;5;12mğŸ” DEBUG: getCurrentUser() completed - User: jerome.revillard@wanadoo.fr[0m
[38;5;12m12:07:45.441 (+0:00:01.444448)[0m
[38;5;12mğŸ” DEBUG: getCurrentUser() completed - result type: Ok<User, Failure>[0m
[38;5;12m12:07:45.441 (+0:00:01.444570)[0m
[38;5;12mğŸ” DEBUG: initializeAuth() - restored user: cmht7oddc000d49s9l4mngmh2[0m
[38;5;12m12:07:45.441 (+0:00:01.444699)[0m
[38;5;12mğŸ” DEBUG: About to set state - isInitialized = TRUE (user restored)[0m
[38;5;12m12:07:45.441 (+0:00:01.444814)[0m
[38;5;12mğŸš¨ [Router Listener] â•â•â• AUTH STATE CHANGE DETECTED â•â•â•[0m
[38;5;12m   - Listener callback TRIGGERED at 2025-11-11T12:07:45.435499[0m
[38;5;12m   - Previous state: auth=false, init=false, user=null, hash=812683058[0m
[38;5;12m   - Next state: auth=true, init=true, user=cmht7oddc000d49s9l4mngmh2, hash=1006098430[0m
[38;5;12m   - States identical: false[0m
[38;5;12m   - States equal: false[0m
12:07:45.441 (+0:00:01.445078)
ğŸš¨ [Router Listener] â•â•â• CRITICAL DEBUG â•â•â•
   - Check at: 2025-11-11T12:07:45.436654
   - Magic link status: MagicLinkVerificationStatus.initial
   - Error message: null
   - Can retry: false
   - State hashCode: 195644548
   - Auth changed: true
   - Hash changed: true
   - About to decide: block or allow router refresh?
12:07:45.442 (+0:00:01.445422)
ğŸš¨ [Router Listener] âœ… Magic link NOT in error state - proceeding with router refresh
   - Continuing at: 2025-11-11T12:07:45.436685
   - Router refresh will proceed normally
[38;5;12m12:07:45.442 (+0:00:01.445603)[0m
[38;5;12mğŸ”„ [Router Refresh] âœ… TRIGGERING ROUTER REFRESH âœ…[0m
[38;5;12m   - Was authenticated: false -> Now authenticated: true[0m
[38;5;12m   - Was initialized: false -> Now initialized: true[0m
[38;5;12m   - User ID: null -> cmht7oddc000d49s9l4mngmh2[0m
[38;5;12m   - Family: [tracked via FamilyProvider, not User entity][0m
[38;5;12m   - Pending Email: null -> null[0m
[38;5;12m   - Hash Code: 812683058 -> 1006098430[0m
[38;5;12m   - âš ï¸ Loading state changes ignored to prevent recursion[0m
[38;5;12m12:07:45.442 (+0:00:01.445929)[0m
[38;5;12m   - Router redirect now focuses ONLY on authentication-based routing[0m
[38;5;12m   - This eliminates GlobalKey conflicts while maintaining navigation flow[0m
[38;5;12m12:07:45.442 (+0:00:01.446080)[0m
[38;5;12mğŸš¨ ARCHITECTURE FIX: GoRouter redirect using FRESH provider context[0m
[38;5;12m   - Using ref.read(authStateProvider) for CURRENT state[0m
[38;5;12m   - Auth state: authenticated=true, init=true[0m
[38;5;12m   - User ID: cmht7oddc000d49s9l4mngmh2[0m
[38;5;12m   - Family: [tracked via UserFamilyService][0m
[38;5;12m   - Provider container mismatch ELIMINATED[0m
[38;5;12mğŸ”„ [GoRouter Redirect] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[38;5;12mğŸ”§ ARCHITECTURE FIX: Always using fresh provider context[0m
[38;5;12mğŸ”„ [GoRouter Redirect] Location: /splash[0m
[38;5;12mğŸ”„ [GoRouter Redirect] Matched Location: /splash[0m
[38;5;12mğŸ”„ [GoRouter Redirect] IsAuthenticated: true[0m
[38;5;12mğŸ”„ [GoRouter Redirect] CurrentUser ID: cmht7oddc000d49s9l4mngmh2[0m
[38;5;12mğŸ”„ [GoRouter Redirect] CurrentUser Email: jerome.revillard@wanadoo.fr[0m
[38;5;12mğŸ”„ [GoRouter Redirect] CurrentUser.family: [via UserFamilyService][0m
[38;5;12mğŸ”„ [GoRouter Redirect] Auth state initialized: true[0m
[38;5;12mğŸ”„ [GoRouter Redirect] Timestamp: 2025-11-11T12:07:45.439016[0m
[38;5;12m12:07:45.443 (+0:00:01.446731)[0m
[38;5;12mğŸ§­ [Router State] NAVIGATION CHECK: hasPending=false, route=null[0m
[38;5;12m12:07:45.443 (+0:00:01.446857)[0m
[38;5;12mğŸ”„ [GoRouter Redirect] DECISION: Authenticated user on splash without family - redirecting to onboarding[0m
[38;5;12m12:07:45.452 (+0:00:01.456180)[0m
[38;5;12mğŸ”„ [Router Refresh] âœ… NOTIFIED GoRouter - _refreshListenable.value is now: 1[0m
[38;5;12m12:07:45.453 (+0:00:01.456405)[0m
[38;5;12mğŸ” DEBUG: State set after user restored - isInitialized: true, isAuthenticated: true, userID: cmht7oddc000d49s9l4mngmh2[0m
[38;5;12m12:07:45.453 (+0:00:01.456546)[0m
[38;5;12mğŸ” DEBUG: initializeAuth() COMPLETE - Final state: isInitialized=true, isAuthenticated=true, userID=cmht7oddc000d49s9l4mngmh2[0m
[38;5;12m12:07:45.453 (+0:00:01.456675)[0m
[38;5;12m   - Router redirect now focuses ONLY on authentication-based routing[0m
[38;5;12m   - This eliminates GlobalKey conflicts while maintaining navigation flow[0m
[38;5;12m12:07:45.453 (+0:00:01.456827)[0m
[38;5;12mğŸš¨ ARCHITECTURE FIX: GoRouter redirect using FRESH provider context[0m
[38;5;12m   - Using ref.read(authStateProvider) for CURRENT state[0m
[38;5;12m   - Auth state: authenticated=true, init=true[0m
[38;5;12m   - User ID: cmht7oddc000d49s9l4mngmh2[0m
[38;5;12m   - Family: [tracked via UserFamilyService][0m
[38;5;12m   - Provider container mismatch ELIMINATED[0m
[38;5;12mğŸ”„ [GoRouter Redirect] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[38;5;12mğŸ”§ ARCHITECTURE FIX: Always using fresh provider context[0m
[38;5;12mğŸ”„ [GoRouter Redirect] Location: /onboarding/wizard[0m
[38;5;12mğŸ”„ [GoRouter Redirect] Matched Location: /onboarding/wizard[0m
[38;5;12mğŸ”„ [GoRouter Redirect] IsAuthenticated: true[0m
[38;5;12mğŸ”„ [GoRouter Redirect] CurrentUser ID: cmht7oddc000d49s9l4mngmh2[0m
[38;5;12mğŸ”„ [GoRouter Redirect] CurrentUser Email: jerome.revillard@wanadoo.fr[0m
[38;5;12mğŸ”„ [GoRouter Redirect] CurrentUser.family: [via UserFamilyService][0m
[38;5;12mğŸ”„ [GoRouter Redirect] Auth state initialized: true[0m
[38;5;12mğŸ”„ [GoRouter Redirect] Timestamp: 2025-11-11T12:07:45.448540[0m
[38;5;12m12:07:45.454 (+0:00:01.457393)[0m
[38;5;12mğŸ§­ [Router State] NAVIGATION CHECK: hasPending=false, route=null[0m
[38;5;12m12:07:45.454 (+0:00:01.457538)[0m
[38;5;12mğŸ”„ [FamilyNotifier] User logged in: cmht7oddc000d49s9l4mngmh2[0m
12:07:45.459 (+0:00:01.462796)
ğŸ”„ [GoRouter Redirect] DECISION: No redirect needed - staying on current route
12:07:45.460 (+0:00:01.464192)
[AutoLoadFamilyNotifier] _shouldAutoLoad check: authState=true, _hasLoaded=false, shouldLoad=true
12:07:45.461 (+0:00:01.464370)
[AutoLoadFamilyNotifier] Auto-loading family for authenticated user: cmht7oddc000d49s9l4mngmh2
[38;5;12m12:07:45.461 (+0:00:01.464466)[0m
[38;5;12mğŸ”„ STATE-COORDINATION: Starting critical state update: Setting loading state for family data[0m
12:07:45.461 (+0:00:01.464601)
ğŸ”„ [Family State] Family state changed but no nullâ†’loaded transition - skipping refresh
   - Previous family: null
   - Next family: null
[38;5;12m12:07:45.466 (+0:00:01.469368)[0m
[38;5;12mğŸ”„ STATE-COORDINATION: Completed critical state update: Setting loading state for family data[0m
[38;5;12m12:07:45.466 (+0:00:01.469608)[0m
[38;5;12m[NETWORK] Stale-While-Revalidate: reading cache for family.getCurrentFamily[0m
[38;5;208m12:07:45.466 (+0:00:01.469725)[0m
[38;5;208mğŸ”“ HiveEncryptionManager: Using in-memory encryption key (development mode)[0m
Recovering corrupted box.
12:07:45.536 (+0:00:01.539827)
ğŸ”„ STATE-COORDINATION: Critical state synchronized: Setting loading state for family data
12:07:45.543 (+0:00:01.546712)
[TimezoneService] Clearing timezone cache
12:07:45.543 (+0:00:01.546949)
[TimezoneService] Checking auto-sync preference...
12:07:45.543 (+0:00:01.547209)
[TimezoneService] Getting device timezone...
12:07:45.544 (+0:00:01.547354)
[TimezoneService] Device timezone abbreviation: CET
12:07:45.544 (+0:00:01.547445)
[TimezoneService] Device timezone: Europe/Paris
12:07:45.544 (+0:00:01.547557)
[TimezoneService] Timezone already in sync
[38;5;208mException: No cached family available[0m
[38;5;208m#0   AppLogger.warning (package:edulift/core/utils/app_logger.dart:311:12)[0m
[38;5;208m#1   <asynchronous suspension>[0m
[38;5;208m12:07:45.590 (+0:00:01.593380)[0m
[38;5;208m[NETWORK] Stale-While-Revalidate: cache failed, trying network for family.getCurrentFamily[0m
[38;5;12m12:07:45.595 (+0:00:01.598707)[0m
[38;5;12m[NETWORK] Network-only strategy for family.getCurrentFamily[0m
12:07:45.595 (+0:00:01.598830)
[NETWORK] Attempt 1/Instance of 'RetryConfig'.maxAttempts for family.getCurrentFamily
12:07:45.606 (+0:00:01.609510)
[AdaptiveSecureStorage] Development mode - using key as-is: "token_expires_at"
[38;5;12m12:07:45.606 (+0:00:01.609758)[0m
[38;5;12m[AdaptiveSecureStorage] Reading from SharedPreferences with key: "token_expires_at" -> found (100 chars)[0m
[38;5;12m12:07:45.701 (+0:00:01.704986)[0m
[38;5;12m[AdaptiveStorageService] Attempting to read token...[0m
[38;5;12m12:07:45.701 (+0:00:01.705172)[0m
[38;5;12m[AdaptiveStorageService] Storage key: "jwt_token_dev"[0m
[38;5;12m12:07:45.701 (+0:00:01.705240)[0m
[38;5;12m[AdaptiveStorageService] Storage backend: AdaptiveSecureStorage[0m
12:07:45.702 (+0:00:01.705633)
[AdaptiveSecureStorage] Development mode - using key as-is: "jwt_token_dev"
[38;5;12m12:07:45.702 (+0:00:01.705826)[0m
[38;5;12m[AdaptiveSecureStorage] Reading from SharedPreferences with key: "jwt_token_dev" -> found (347 chars)[0m
12:07:45.702 (+0:00:01.705988)
[AdaptiveStorageService] Development mode - read token: [347 chars]
12:07:45.702 (+0:00:01.706163)
[AdaptiveStorageService] Retrieved dev token: eyJhbGciOiJIUzI1NiIs... (347 chars)
12:07:45.703 (+0:00:01.707249)
[TimezoneService] Clearing timezone cache
12:07:45.704 (+0:00:01.707379)
[TimezoneService] Checking auto-sync preference...
12:07:45.704 (+0:00:01.707534)
[TimezoneService] Getting device timezone...
12:07:45.704 (+0:00:01.707626)
[TimezoneService] Device timezone abbreviation: CET
12:07:45.704 (+0:00:01.707723)
[TimezoneService] Device timezone: Europe/Paris
12:07:45.704 (+0:00:01.707822)
[TimezoneService] Timezone already in sync
*** Request ***
uri: http://localhost:3001/api/v1/families/current
method: GET
responseType: ResponseType.json
followRedirects: true
persistentConnection: true
connectTimeout: 0:00:10.000000
sendTimeout: 0:00:10.000000
receiveTimeout: 0:00:15.000000
receiveDataWhenStatusError: true
extra: {}
headers:
 Content-Type: application/json
 Accept: application/json
 API-Version: v1
 Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbWh0N29kZGMwMDBkNDlzOWw0bW5nbWgyIiwiZW1haWwiOiJqZXJvbWUucmV2aWxsYXJkQHdhbmFkb28uZnIiLCJuYW1lIjoiSsOpcsO0bWUgUmV2aWxsYXJkIiwianRpIjoiN2Y4NjIxODg3NDAxMjU5NTU4NjZlMGJlMTlhYzg4OGIiLCJpYXQiOjE3NjI4NTkwNTIsImV4cCI6MTc2Mjg1OTk1MiwiaXNzIjoiZWR1bGlmdC1hcGkifQ.k83wIlJnIaHUNnTabLzey4jJ1IbCwMq-xXthuahTDJg
data:
null

*** Response ***
uri: http://localhost:3001/api/v1/families/current
statusCode: 200
headers:
 connection: keep-alive
 x-dns-prefetch-control: off
 date: Tue, 11 Nov 2025 11:07:45 GMT
 access-control-allow-origin: *
 origin-agent-cluster: ?1
 strict-transport-security: max-age=31536000; includeSubDomains
 referrer-policy: no-referrer
 x-permitted-cross-domain-policies: none
 content-type: application/json; charset=utf-8
 cross-origin-opener-policy: same-origin
 x-xss-protection: 0
 cross-origin-resource-policy: same-origin
 access-control-allow-credentials: true
 keep-alive: timeout=5
 content-length: 925
 x-download-options: noopen
 etag: W/"39d-HYnUEAgXyvBPbbTsh0M6n4bBFwQ"
 x-frame-options: SAMEORIGIN
 x-content-type-options: nosniff
 content-security-policy: default-src 'self';base-uri 'self';font-src 'self' https: data:;form-action 'self';frame-ancestors 'self';img-src 'self' data:;object-src 'none';script-src 'self';script-src-attr 'none';style-src 'self' https: 'unsafe-inline';upgrade-insecure-requests
Response Text:
{"id":"cmht7q9ng000l49s9tecphjog","name":"Revillard","createdAt":"2025-11-10T14:03:31.802Z","updatedAt":"2025-11-10T14:03:31.802Z","members":[{"id":"cmht7q9nk000n49s9ie5fo6zx","familyId":"cmht7q9ng000l49s9tecphjog","userId":"cmht7oddc000d49s9l4mngmh2","role":"ADMIN","joinedAt":"2025-11-10T14:03:31.808Z","user":{"id":"cmht7oddc000d49s9l4mngmh2","email":"jerome.revillard@wanadoo.fr","name":"JÃ©rÃ´me Revillard","createdAt":"2025-11-10T14:02:03.312Z","updatedAt":"2025-11-10T17:57:51.451Z","timezone":"Europe/Paris"}}],"children":[{"id":"cmhtf7ruu000d310s655mtphd","name":"Emmie","age":null,"familyId":"cmht7q9ng000l49s9tecphjog","createdAt":"2025-11-10T17:33:05.862Z","updatedAt":"2025-11-10T17:33:05.862Z"}],"vehicles":[{"id":"cmhtf7z5t000f310ssnu039c3","name":"MG4","capacity":5,"familyId":"cmht7q9ng000l49s9tecphjog","createdAt":"2025-11-10T17:33:15.329Z","updatedAt":"2025-11-10T17:33:15.329Z"}]}

[38;5;12m12:07:45.894 (+0:00:01.898012)[0m
[38;5;12m[FAMILY] Family cached successfully after network success[0m
12:07:45.894 (+0:00:01.898211)
[NETWORK] onSuccess callback executed for family.getCurrentFamily
[38;5;12m12:07:45.894 (+0:00:01.898314)[0m
[38;5;12m[NETWORK] Network-only strategy for invitation.getPendingInvitations[0m
12:07:45.895 (+0:00:01.898420)
[NETWORK] Attempt 1/Instance of 'RetryConfig'.maxAttempts for invitation.getPendingInvitations
12:07:45.895 (+0:00:01.898543)
[FamilyRemoteDataSource] getFamilyInvitations() called for familyId: cmht7q9ng000l49s9tecphjog
12:07:45.895 (+0:00:01.899026)
[AdaptiveSecureStorage] Development mode - using key as-is: "token_expires_at"
[38;5;12m12:07:45.895 (+0:00:01.899183)[0m
[38;5;12m[AdaptiveSecureStorage] Reading from SharedPreferences with key: "token_expires_at" -> found (100 chars)[0m
[38;5;12m12:07:45.959 (+0:00:01.962625)[0m
[38;5;12m[AdaptiveStorageService] Attempting to read token...[0m
[38;5;12m12:07:45.959 (+0:00:01.962840)[0m
[38;5;12m[AdaptiveStorageService] Storage key: "jwt_token_dev"[0m
[38;5;12m12:07:45.959 (+0:00:01.962955)[0m
[38;5;12m[AdaptiveStorageService] Storage backend: AdaptiveSecureStorage[0m
12:07:45.959 (+0:00:01.963185)
[AdaptiveSecureStorage] Development mode - using key as-is: "jwt_token_dev"
[38;5;12m12:07:45.959 (+0:00:01.963320)[0m
[38;5;12m[AdaptiveSecureStorage] Reading from SharedPreferences with key: "jwt_token_dev" -> found (347 chars)[0m
12:07:45.960 (+0:00:01.963439)
[AdaptiveStorageService] Development mode - read token: [347 chars]
12:07:45.960 (+0:00:01.963560)
[AdaptiveStorageService] Retrieved dev token: eyJhbGciOiJIUzI1NiIs... (347 chars)
*** Request ***
uri: http://localhost:3001/api/v1/families/cmht7q9ng000l49s9tecphjog/invitations
method: GET
responseType: ResponseType.json
followRedirects: true
persistentConnection: true
connectTimeout: 0:00:10.000000
sendTimeout: 0:00:10.000000
receiveTimeout: 0:00:15.000000
receiveDataWhenStatusError: true
extra: {}
headers:
 Content-Type: application/json
 Accept: application/json
 API-Version: v1
 Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbWh0N29kZGMwMDBkNDlzOWw0bW5nbWgyIiwiZW1haWwiOiJqZXJvbWUucmV2aWxsYXJkQHdhbmFkb28uZnIiLCJuYW1lIjoiSsOpcsO0bWUgUmV2aWxsYXJkIiwianRpIjoiN2Y4NjIxODg3NDAxMjU5NTU4NjZlMGJlMTlhYzg4OGIiLCJpYXQiOjE3NjI4NTkwNTIsImV4cCI6MTc2Mjg1OTk1MiwiaXNzIjoiZWR1bGlmdC1hcGkifQ.k83wIlJnIaHUNnTabLzey4jJ1IbCwMq-xXthuahTDJg
data:
null

*** Response ***
uri: http://localhost:3001/api/v1/families/cmht7q9ng000l49s9tecphjog/invitations
statusCode: 200
headers:
 connection: keep-alive
 x-dns-prefetch-control: off
 date: Tue, 11 Nov 2025 11:07:45 GMT
 access-control-allow-origin: *
 origin-agent-cluster: ?1
 strict-transport-security: max-age=31536000; includeSubDomains
 referrer-policy: no-referrer
 x-permitted-cross-domain-policies: none
 content-type: application/json; charset=utf-8
 cross-origin-opener-policy: same-origin
 x-xss-protection: 0
 cross-origin-resource-policy: same-origin
 access-control-allow-credentials: true
 keep-alive: timeout=5
 content-length: 26
 x-download-options: noopen
 etag: W/"1a-s3B6blipWxCo2IriQlJeaz0uh7I"
 x-frame-options: SAMEORIGIN
 x-content-type-options: nosniff
 content-security-policy: default-src 'self';base-uri 'self';font-src 'self' https: data:;form-action 'self';frame-ancestors 'self';img-src 'self' data:;object-src 'none';script-src 'self';script-src-attr 'none';style-src 'self' https: 'unsafe-inline';upgrade-insecure-requests
Response Text:
[]

12:07:45.985 (+0:00:01.988632)
[FamilyRemoteDataSource] Successfully loaded 0 family invitations
[38;5;12m12:07:45.989 (+0:00:01.992559)[0m
[38;5;12m[INVITATION] Cached 0 pending invitations[0m
12:07:45.989 (+0:00:01.992792)
[NETWORK] onSuccess callback executed for invitation.getPendingInvitations
[38;5;12m12:07:45.989 (+0:00:01.992910)[0m
[38;5;12mğŸ”„ STATE-COORDINATION: Starting critical state update: Setting loaded family data[0m
[38;5;12m12:07:45.989 (+0:00:01.993037)[0m
[38;5;12mğŸ”„ [Router Refresh] Family loaded - scheduling debounced router refresh[0m
[38;5;12m   - Previous family: null[0m
[38;5;12m   - New family: cmht7q9ng000l49s9tecphjog[0m
[38;5;12m   - Debounce delay: 500ms to prevent cascade[0m
[38;5;12m12:07:46.289 (+0:00:02.292347)[0m
[38;5;12mğŸ”„ STATE-COORDINATION: Completed critical state update: Setting loaded family data[0m
12:07:46.289 (+0:00:02.292530)
[FamilyProvider] Family loaded: Revillard, Children: 1, Vehicles: 1, Pending invitations: 0
12:07:46.313 (+0:00:02.317070)
ğŸ”„ STATE-COORDINATION: Critical state synchronized: Setting loaded family data
[38;5;12m12:07:46.491 (+0:00:02.494564)[0m
[38;5;12m   - Router redirect now focuses ONLY on authentication-based routing[0m
[38;5;12m   - This eliminates GlobalKey conflicts while maintaining navigation flow[0m
[38;5;12m12:07:46.491 (+0:00:02.494728)[0m
[38;5;12mğŸš¨ ARCHITECTURE FIX: GoRouter redirect using FRESH provider context[0m
[38;5;12m   - Using ref.read(authStateProvider) for CURRENT state[0m
[38;5;12m   - Auth state: authenticated=true, init=true[0m
[38;5;12m   - User ID: cmht7oddc000d49s9l4mngmh2[0m
[38;5;12m   - Family: [tracked via UserFamilyService][0m
[38;5;12m   - Provider container mismatch ELIMINATED[0m
[38;5;12mğŸ”„ [GoRouter Redirect] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[38;5;12mğŸ”§ ARCHITECTURE FIX: Always using fresh provider context[0m
[38;5;12mğŸ”„ [GoRouter Redirect] Location: /onboarding/wizard[0m
[38;5;12mğŸ”„ [GoRouter Redirect] Matched Location: /onboarding/wizard[0m
[38;5;12mğŸ”„ [GoRouter Redirect] IsAuthenticated: true[0m
[38;5;12mğŸ”„ [GoRouter Redirect] CurrentUser ID: cmht7oddc000d49s9l4mngmh2[0m
[38;5;12mğŸ”„ [GoRouter Redirect] CurrentUser Email: jerome.revillard@wanadoo.fr[0m
[38;5;12mğŸ”„ [GoRouter Redirect] CurrentUser.family: [via UserFamilyService][0m
[38;5;12mğŸ”„ [GoRouter Redirect] Auth state initialized: true[0m
[38;5;12mğŸ”„ [GoRouter Redirect] Timestamp: 2025-11-11T12:07:46.490678[0m
[38;5;12m12:07:46.491 (+0:00:02.495115)[0m
[38;5;12mğŸ§­ [Router State] NAVIGATION CHECK: hasPending=false, route=null[0m
[38;5;12m12:07:46.491 (+0:00:02.495206)[0m
[38;5;12mğŸ”„ [GoRouter Redirect] DECISION: User with family on onboarding wizard - redirecting to dashboard[0m
[38;5;12m12:07:46.495 (+0:00:02.499184)[0m
[38;5;12mğŸ”„ [Router Refresh] Debounced refresh executed - count: 2[0m
[38;5;12m12:07:46.496 (+0:00:02.499351)[0m
[38;5;12m   - Router redirect now focuses ONLY on authentication-based routing[0m
[38;5;12m   - This eliminates GlobalKey conflicts while maintaining navigation flow[0m
[38;5;12m12:07:46.496 (+0:00:02.499464)[0m
[38;5;12mğŸš¨ ARCHITECTURE FIX: GoRouter redirect using FRESH provider context[0m
[38;5;12m   - Using ref.read(authStateProvider) for CURRENT state[0m
[38;5;12m   - Auth state: authenticated=true, init=true[0m
[38;5;12m   - User ID: cmht7oddc000d49s9l4mngmh2[0m
[38;5;12m   - Family: [tracked via UserFamilyService][0m
[38;5;12m   - Provider container mismatch ELIMINATED[0m
[38;5;12mğŸ”„ [GoRouter Redirect] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[38;5;12mğŸ”§ ARCHITECTURE FIX: Always using fresh provider context[0m
[38;5;12mğŸ”„ [GoRouter Redirect] Location: /dashboard[0m
[38;5;12mğŸ”„ [GoRouter Redirect] Matched Location: /dashboard[0m
[38;5;12mğŸ”„ [GoRouter Redirect] IsAuthenticated: true[0m
[38;5;12mğŸ”„ [GoRouter Redirect] CurrentUser ID: cmht7oddc000d49s9l4mngmh2[0m
[38;5;12mğŸ”„ [GoRouter Redirect] CurrentUser Email: jerome.revillard@wanadoo.fr[0m
[38;5;12mğŸ”„ [GoRouter Redirect] CurrentUser.family: [via UserFamilyService][0m
[38;5;12mğŸ”„ [GoRouter Redirect] Auth state initialized: true[0m
[38;5;12mğŸ”„ [GoRouter Redirect] Timestamp: 2025-11-11T12:07:46.495477[0m
[38;5;12m12:07:46.496 (+0:00:02.499984)[0m
[38;5;12mğŸ§­ [Router State] NAVIGATION CHECK: hasPending=false, route=null[0m
12:07:46.496 (+0:00:02.500116)
ğŸ”„ [GoRouter Redirect] DECISION: No redirect needed - staying on current route
{familyId: cmht7q9ng000l49s9tecphjog, userTimezone: Europe/Paris}
#0   AppLogger.debug (package:edulift/core/utils/app_logger.dart:285:12)
#1   <asynchronous suspension>
12:07:46.676 (+0:00:02.679859)
Fetching 7-day transport summary with family filtering
{familyId: cmht7q9ng000l49s9tecphjog, vehicleCount: 1}
#0   AppLogger.debug (package:edulift/core/utils/app_logger.dart:285:12)
#1   <asynchronous suspension>
12:07:46.677 (+0:00:02.680688)
Loaded family vehicles from FamilyState
[38;5;12m12:07:46.677 (+0:00:02.681013)[0m
[38;5;12m[NETWORK] Network-only strategy for groups.getGroups[0m
12:07:46.677 (+0:00:02.681099)
[NETWORK] Attempt 1/Instance of 'RetryConfig'.maxAttempts for groups.getGroups
12:07:46.679 (+0:00:02.682470)
ğŸ§­ NAVIGATION_STATE: clearNavigation called but no navigation pending
12:07:46.679 (+0:00:02.683261)
[AdaptiveSecureStorage] Development mode - using key as-is: "token_expires_at"
[38;5;12m12:07:46.680 (+0:00:02.683394)[0m
[38;5;12m[AdaptiveSecureStorage] Reading from SharedPreferences with key: "token_expires_at" -> found (100 chars)[0m
[38;5;12m12:07:46.738 (+0:00:02.741872)[0m
[38;5;12m[AdaptiveStorageService] Attempting to read token...[0m
[38;5;12m12:07:46.738 (+0:00:02.742056)[0m
[38;5;12m[AdaptiveStorageService] Storage key: "jwt_token_dev"[0m
[38;5;12m12:07:46.738 (+0:00:02.742112)[0m
[38;5;12m[AdaptiveStorageService] Storage backend: AdaptiveSecureStorage[0m
12:07:46.738 (+0:00:02.742239)
[AdaptiveSecureStorage] Development mode - using key as-is: "jwt_token_dev"
[38;5;12m12:07:46.738 (+0:00:02.742305)[0m
[38;5;12m[AdaptiveSecureStorage] Reading from SharedPreferences with key: "jwt_token_dev" -> found (347 chars)[0m
12:07:46.739 (+0:00:02.742372)
[AdaptiveStorageService] Development mode - read token: [347 chars]
12:07:46.739 (+0:00:02.742442)
[AdaptiveStorageService] Retrieved dev token: eyJhbGciOiJIUzI1NiIs... (347 chars)
*** Request ***
uri: http://localhost:3001/api/v1/groups/my-groups
method: GET
responseType: ResponseType.json
followRedirects: true
persistentConnection: true
connectTimeout: 0:00:10.000000
sendTimeout: 0:00:10.000000
receiveTimeout: 0:00:15.000000
receiveDataWhenStatusError: true
extra: {}
headers:
 Content-Type: application/json
 Accept: application/json
 API-Version: v1
 Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbWh0N29kZGMwMDBkNDlzOWw0bW5nbWgyIiwiZW1haWwiOiJqZXJvbWUucmV2aWxsYXJkQHdhbmFkb28uZnIiLCJuYW1lIjoiSsOpcsO0bWUgUmV2aWxsYXJkIiwianRpIjoiN2Y4NjIxODg3NDAxMjU5NTU4NjZlMGJlMTlhYzg4OGIiLCJpYXQiOjE3NjI4NTkwNTIsImV4cCI6MTc2Mjg1OTk1MiwiaXNzIjoiZWR1bGlmdC1hcGkifQ.k83wIlJnIaHUNnTabLzey4jJ1IbCwMq-xXthuahTDJg
data:
null

*** Response ***
uri: http://localhost:3001/api/v1/groups/my-groups
statusCode: 200
headers:
 connection: keep-alive
 x-dns-prefetch-control: off
 date: Tue, 11 Nov 2025 11:07:46 GMT
 access-control-allow-origin: *
 origin-agent-cluster: ?1
 strict-transport-security: max-age=31536000; includeSubDomains
 referrer-policy: no-referrer
 x-permitted-cross-domain-policies: none
 content-type: application/json; charset=utf-8
 cross-origin-opener-policy: same-origin
 x-xss-protection: 0
 cross-origin-resource-policy: same-origin
 access-control-allow-credentials: true
 keep-alive: timeout=5
 content-length: 367
 x-download-options: noopen
 etag: W/"16f-xOTtxEjnnBfK/24A+NGjoJUIDT8"
 x-frame-options: SAMEORIGIN
 x-content-type-options: nosniff
 content-security-policy: default-src 'self';base-uri 'self';font-src 'self' https: data:;form-action 'self';frame-ancestors 'self';img-src 'self' data:;object-src 'none';script-src 'self';script-src-attr 'none';style-src 'self' https: 'unsafe-inline';upgrade-insecure-requests
Response Text:
[{id: cmht7r6yl000p49s9ssvadvsd, name: CollÃ¨ge, description: null, familyId: cmht7q9ng000l49s9tecphjog, inviteCode: 79D0AA31D7466720, createdAt: 2025-11-10T14:04:14.971Z, updatedAt: 2025-11-10T14:04:14.971Z, userRole: ADMIN, ownerFamily: {id: cmht7q9ng000l49s9tecphjog, name: Revillard}, familyCount: 1, scheduleCount: 3}]

Recovering corrupted box.
[38;5;12m12:07:46.853 (+0:00:02.856896)[0m
[38;5;12m[GROUPS] User groups cached successfully after network success[0m
12:07:46.853 (+0:00:02.857047)
[NETWORK] onSuccess callback executed for groups.getGroups
{utcTime: 2025-11-11T11:07:46.849143Z, timezone: Europe/Paris}
#0   AppLogger.debug (package:edulift/core/utils/app_logger.dart:285:12)
#1   <asynchronous suspension>
12:07:46.853 (+0:00:02.857127)
[TimezoneService] Converting UTC to local
12:07:46.854 (+0:00:02.858119)
[TimezoneService] Converted to local: 2025-11-11T12:07:46.849143+0100
{date: 2025-11-11T00:00:00.000, userTimezone: Europe/Paris, weekFormat: 2025-W02}
#0   AppLogger.debug (package:edulift/core/utils/app_logger.dart:285:12)
#1   <asynchronous suspension>
12:07:46.854 (+0:00:02.858216)
[TransportProviders] Generated timezone-aware week format
{startDate: 2025-11-11T00:00:00.000, weekFormat: 2025-W02, groupCount: 1}
#0   AppLogger.debug (package:edulift/core/utils/app_logger.dart:285:12)
#1   <asynchronous suspension>
12:07:46.855 (+0:00:02.858515)
Fetching schedules for 7-day period
[38;5;12m12:07:46.855 (+0:00:02.858754)[0m
[38;5;12m[NETWORK] Network-only strategy for schedule.getWeeklySchedule[0m
12:07:46.855 (+0:00:02.858823)
[NETWORK] Attempt 1/Instance of 'RetryConfig'.maxAttempts for schedule.getWeeklySchedule
{groupId: cmht7r6yl000p49s9ssvadvsd, week: 2025-W02}
#0   AppLogger.debug (package:edulift/core/utils/app_logger.dart:285:12)
#1   <asynchronous suspension>
12:07:46.855 (+0:00:02.858885)
[ScheduleRemoteDataSource] getWeeklySchedule() called
12:07:46.862 (+0:00:02.865792)
[AdaptiveSecureStorage] Development mode - using key as-is: "token_expires_at"
[38;5;12m12:07:46.862 (+0:00:02.866003)[0m
[38;5;12m[AdaptiveSecureStorage] Reading from SharedPreferences with key: "token_expires_at" -> found (100 chars)[0m
[38;5;12m12:07:46.926 (+0:00:02.930195)[0m
[38;5;12m[AdaptiveStorageService] Attempting to read token...[0m
[38;5;12m12:07:46.927 (+0:00:02.930376)[0m
[38;5;12m[AdaptiveStorageService] Storage key: "jwt_token_dev"[0m
[38;5;12m12:07:46.927 (+0:00:02.930457)[0m
[38;5;12m[AdaptiveStorageService] Storage backend: AdaptiveSecureStorage[0m
12:07:46.927 (+0:00:02.930612)
[AdaptiveSecureStorage] Development mode - using key as-is: "jwt_token_dev"
[38;5;12m12:07:46.927 (+0:00:02.930697)[0m
[38;5;12m[AdaptiveSecureStorage] Reading from SharedPreferences with key: "jwt_token_dev" -> found (347 chars)[0m
12:07:46.927 (+0:00:02.930783)
[AdaptiveStorageService] Development mode - read token: [347 chars]
12:07:46.927 (+0:00:02.930853)
[AdaptiveStorageService] Retrieved dev token: eyJhbGciOiJIUzI1NiIs... (347 chars)
*** Request ***
uri: http://localhost:3001/api/v1/groups/cmht7r6yl000p49s9ssvadvsd/schedule?startDate=2025-01-06T00%3A00%3A00.000Z&endDate=2025-01-12T23%3A59%3A59.999Z
method: GET
responseType: ResponseType.json
followRedirects: true
persistentConnection: true
connectTimeout: 0:00:10.000000
sendTimeout: 0:00:10.000000
receiveTimeout: 0:00:15.000000
receiveDataWhenStatusError: true
extra: {}
headers:
 Content-Type: application/json
 Accept: application/json
 API-Version: v1
 Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbWh0N29kZGMwMDBkNDlzOWw0bW5nbWgyIiwiZW1haWwiOiJqZXJvbWUucmV2aWxsYXJkQHdhbmFkb28uZnIiLCJuYW1lIjoiSsOpcsO0bWUgUmV2aWxsYXJkIiwianRpIjoiN2Y4NjIxODg3NDAxMjU5NTU4NjZlMGJlMTlhYzg4OGIiLCJpYXQiOjE3NjI4NTkwNTIsImV4cCI6MTc2Mjg1OTk1MiwiaXNzIjoiZWR1bGlmdC1hcGkifQ.k83wIlJnIaHUNnTabLzey4jJ1IbCwMq-xXthuahTDJg
data:
null

*** Response ***
uri: http://localhost:3001/api/v1/groups/cmht7r6yl000p49s9ssvadvsd/schedule?startDate=2025-01-06T00%3A00%3A00.000Z&endDate=2025-01-12T23%3A59%3A59.999Z
statusCode: 200
headers:
 connection: keep-alive
 x-dns-prefetch-control: off
 date: Tue, 11 Nov 2025 11:07:46 GMT
 access-control-allow-origin: *
 origin-agent-cluster: ?1
 strict-transport-security: max-age=31536000; includeSubDomains
 referrer-policy: no-referrer
 x-permitted-cross-domain-policies: none
 content-type: application/json; charset=utf-8
 cross-origin-opener-policy: same-origin
 x-xss-protection: 0
 cross-origin-resource-policy: same-origin
 access-control-allow-credentials: true
 keep-alive: timeout=5
 content-length: 158
 x-download-options: noopen
 etag: W/"9e-CnJ82H8zDqE4JGkMYk6sIhBI1T8"
 x-frame-options: SAMEORIGIN
 x-content-type-options: nosniff
 content-security-policy: default-src 'self';base-uri 'self';font-src 'self' https: data:;form-action 'self';frame-ancestors 'self';img-src 'self' data:;object-src 'none';script-src 'self';script-src-attr 'none';style-src 'self' https: 'unsafe-inline';upgrade-insecure-requests
Response Text:
{"groupId":"cmht7r6yl000p49s9ssvadvsd","startDate":"2025-01-06T00:00:00.000Z","endDate":"2025-01-12T23:59:59.999Z","scheduleSlots":[]}

12:07:46.967 (+0:00:02.970385)
[ScheduleRemoteDataSource] Successfully fetched 0 schedule slots
Recovering corrupted box.
[38;5;12m12:07:46.982 (+0:00:02.985869)[0m
[38;5;12m[SCHEDULE] Weekly schedule cached successfully after network success[0m
12:07:46.983 (+0:00:02.986584)
[NETWORK] onSuccess callback executed for schedule.getWeeklySchedule
{groupId: cmht7r6yl000p49s9ssvadvsd, groupName: CollÃ¨ge, totalSlots: 0, relevantSlots: 0, filteredSlots: 0}
#0   AppLogger.debug (package:edulift/core/utils/app_logger.dart:285:12)
#1   <asynchronous suspension>
12:07:46.983 (+0:00:02.987064)
Processed group schedules
{familyId: cmht7q9ng000l49s9tecphjog, totalSlots: 0, daysWithData: 0}
#0   AppLogger.debug (package:edulift/core/utils/app_logger.dart:285:12)
#1   <asynchronous suspension>
12:07:46.984 (+0:00:02.987442)
Successfully generated 7-day transport summary
{utcTime: 2025-11-11T11:07:46.988968Z, timezone: Europe/Paris}
#0   AppLogger.debug (package:edulift/core/utils/app_logger.dart:285:12)
#1   <asynchronous suspension>
12:07:47.072 (+0:00:03.075890)
[TimezoneService] Converting UTC to local
12:07:47.072 (+0:00:03.076301)
[TimezoneService] Converted to local: 2025-11-11T12:07:46.988968+0100
Application finished.
